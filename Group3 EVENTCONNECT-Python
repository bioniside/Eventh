
# HOUSE PRICES DATA CLEANING, PREPROCESSING & VISUALIZATION

# ðŸ”¹ 1. IMPORT LIBRARIES
import pandas as pd
import numpy as np
import os
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

# ðŸ”¹ 2. LOAD DATA
train_path = r"C:\Users\Bioni\Desktop\House price\train.csv"
test_path  = r"C:\Users\Bioni\Desktop\House price\test.csv"

train_df = pd.read_csv(train_path)
test_df  = pd.read_csv(test_path)

print("Train shape:", train_df.shape)
print("Test shape:", test_df.shape)

# ðŸ”¹ 3. HANDLE MISSING VALUES
train_df = train_df.dropna(subset=['SalePrice'])

num_cols = train_df.select_dtypes(include=['int64', 'float64']).columns
cat_cols = train_df.select_dtypes(include=['object']).columns

# Fill numeric columns
for col in num_cols:
    train_df[col] = train_df[col].fillna(train_df[col].mean())
    if col in test_df.columns:
        test_df[col] = test_df[col].fillna(test_df[col].mean())

# Fill categorical columns
for col in cat_cols:
    train_df[col] = train_df[col].fillna("None")
    if col in test_df.columns:
        test_df[col] = test_df[col].fillna("None")

# ðŸ”¹ 4. REMOVE DUPLICATES
train_df = train_df.drop_duplicates()

# ðŸ”¹ 5. DATE HANDLING
for df in [train_df, test_df]:
    df['date'] = pd.to_datetime(df['YrSold'].astype(str) + "-" + df['MoSold'].astype(str) + "-01")
    df['year'] = df['date'].dt.year

# ðŸ”¹ 6. OUTLIER REMOVAL (Train only)
Q1 = train_df['SalePrice'].quantile(0.25)
Q3 = train_df['SalePrice'].quantile(0.75)
IQR = Q3 - Q1
train_df = train_df[(train_df['SalePrice'] >= Q1 - 1.5*IQR) & 
                    (train_df['SalePrice'] <= Q3 + 1.5*IQR)]

# ðŸ”¹ 7. SKEWNESS HANDLING
train_df['SalePrice'] = np.log1p(train_df['SalePrice'])

# ðŸ”¹ 8. FEATURE ENGINEERING
for df in [train_df, test_df]:
    df['TotalSF'] = df['TotalBsmtSF'] + df['1stFlrSF'] + df['2ndFlrSF']
    df['TotalBath'] = df['FullBath'] + 0.5 * df['HalfBath']
    df['HouseAge'] = df['YrSold'] - df['YearBuilt']

# ðŸ”¹ 9. ENCODING CATEGORICAL VARIABLES
combined = pd.concat([train_df, test_df], sort=False)
combined = pd.get_dummies(combined, drop_first=True)

# Split back
train_df = combined.loc[train_df.index].copy()
test_df  = combined.loc[test_df.index].copy()

# ðŸ”¹ 10. SCALING NUMERIC FEATURES
num_features = train_df.select_dtypes(include=['float64', 'int64']).columns
scaler = StandardScaler()
train_df[num_features] = scaler.fit_transform(train_df[num_features])
common_num_features = [col for col in num_features if col in test_df.columns]
test_df[common_num_features] = scaler.transform(test_df[common_num_features])

# ðŸ”¹ 11. VALIDATION CHECKS
print("Any missing values left in train?", train_df.isnull().sum().sum())
print("Train shape:", train_df.shape)
print("Test shape:", test_df.shape)

# ðŸ”¹ 12. SAVE CLEANED DATA
os.makedirs("data", exist_ok=True)
train_df.to_csv("data/house_prices_train_cleaned.csv", index=False)
test_df.to_csv("data/house_prices_test_cleaned.csv", index=False)
print("âœ… Cleaned train and test datasets saved in data/ folder")


# 13. DATA VISUALIZATION
 

sns.set_style('whitegrid')
plt.rcParams['figure.figsize'] = (10,6)

# ðŸ”¹ Distribution of SalePrice
plt.figure(figsize=(10,6))
sns.histplot(train_df['SalePrice'], bins=50, kde=True, color='skyblue')
plt.title('Distribution of SalePrice (log-transformed)')
plt.xlabel('SalePrice')
plt.ylabel('Frequency')
plt.show()

# ðŸ”¹ Correlation Heatmap
plt.figure(figsize=(12,10))
corr_matrix = train_df.corr()
sns.heatmap(corr_matrix, annot=False, cmap='coolwarm')
plt.title('Correlation Heatmap')
plt.show()

# ðŸ”¹ Top 10 features correlated with SalePrice
top_corr_features = corr_matrix['SalePrice'].sort_values(ascending=False)[1:11]
plt.figure(figsize=(8,6))
sns.barplot(x=top_corr_features.values, y=top_corr_features.index, palette='viridis')
plt.title('Top 10 Features Correlated with SalePrice')
plt.xlabel('Correlation')
plt.ylabel('Feature')
plt.show()

# ðŸ”¹ Scatterplot: SalePrice vs TotalSF
plt.figure(figsize=(10,6))
sns.scatterplot(data=train_df, x='TotalSF', y='SalePrice', hue='HouseAge', palette='coolwarm', alpha=0.7)
plt.title('SalePrice vs Total Square Footage')
plt.xlabel('Total Square Footage')
plt.ylabel('SalePrice')
plt.show()

# ðŸ”¹ Scatterplot: SalePrice vs HouseAge
plt.figure(figsize=(10,6))
sns.scatterplot(data=train_df, x='HouseAge', y='SalePrice', color='green', alpha=0.6)
plt.title('SalePrice vs House Age')
plt.xlabel('House Age (Years)')
plt.ylabel('SalePrice')
plt.show()

# ðŸ”¹ Boxplot: SalePrice vs Overall Quality (if exists)
if 'OverallQual' in train_df.columns:
    plt.figure(figsize=(10,6))
    sns.boxplot(x='OverallQual', y='SalePrice', data=train_df, palette='magma')
    plt.title('SalePrice vs Overall Quality')
    plt.xlabel('Overall Quality')
    plt.ylabel('SalePrice')
    plt.show()

# ðŸ”¹ Pairplot of top 5 features vs SalePrice
top_features = top_corr_features.index[:5].tolist()
sns.pairplot(train_df, x_vars=top_features, y_vars='SalePrice', height=3, kind='scatter', diag_kind=None)
plt.suptitle('Pairplot: Top Features vs SalePrice', y=1.02)
plt.show()
